{"ast":null,"code":"import{create}from'zustand';import{persist}from'zustand/middleware';import{adminApi,apiUtils}from'../api';export const useAuthStore=create()(persist((set,get)=>({user:null,token:null,loading:false,error:null,login:async credentials=>{set({loading:true,error:null});try{const tokenResponse=await adminApi.login(credentials);// Store token\nlocalStorage.setItem('admin_token',tokenResponse.access_token);set({token:tokenResponse.access_token,user:{username:credentials.username,// Mock user data - in real app, fetch user details\nid:1,email:'',is_active:true,is_superuser:true,created_at:new Date().toISOString()},loading:false});return true;}catch(error){set({error:apiUtils.handleApiError(error),loading:false});return false;}},logout:()=>{localStorage.removeItem('admin_token');set({user:null,token:null,error:null});},checkAuth:async()=>{const token=localStorage.getItem('admin_token');if(token){try{// Validierung durch einen API-Call zum Backend\nawait adminApi.getReviews({page:1,per_page:1});set({token,user:{id:1,username:'admin',email:'admin@guestbook.local',is_active:true,is_superuser:true,created_at:new Date().toISOString()}});}catch(error){var _error$response,_error$response2;// Token ist ungültig oder Session abgelaufen\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401||((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)===403){localStorage.removeItem('admin_token');set({token:null,user:null});}}}},// Neue Funktion für kontinuierliche Session-Überwachung\nvalidateSession:async()=>{const token=get().token;if(!token)return false;try{await adminApi.getReviews({page:1,per_page:1});return true;}catch(error){var _error$response3,_error$response4;if(((_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status)===401||((_error$response4=error.response)===null||_error$response4===void 0?void 0:_error$response4.status)===403){get().logout();return false;}return true;// Anderer Fehler, Session könnte noch gültig sein\n}},clearError:()=>set({error:null})}),{name:'auth-storage',partialize:state=>({token:state.token,user:state.user})}));","map":{"version":3,"names":["create","persist","adminApi","apiUtils","useAuthStore","set","get","user","token","loading","error","login","credentials","tokenResponse","localStorage","setItem","access_token","username","id","email","is_active","is_superuser","created_at","Date","toISOString","handleApiError","logout","removeItem","checkAuth","getItem","getReviews","page","per_page","_error$response","_error$response2","response","status","validateSession","_error$response3","_error$response4","clearError","name","partialize","state"],"sources":["/Users/renesuss/Development/Tools/src/guestbook-project/frontend/src/store/authStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { AuthStore, LoginForm, AdminUser } from '../types';\nimport { adminApi, apiUtils } from '../api';\n\nexport const useAuthStore = create<AuthStore>()(\n  persist(\n    (set, get) => ({\n      user: null,\n      token: null,\n      loading: false,\n      error: null,\n\n      login: async (credentials: LoginForm) => {\n        set({ loading: true, error: null });\n        try {\n          const tokenResponse = await adminApi.login(credentials);\n          \n          // Store token\n          localStorage.setItem('admin_token', tokenResponse.access_token);\n          \n          set({\n            token: tokenResponse.access_token,\n            user: { \n              username: credentials.username,\n              // Mock user data - in real app, fetch user details\n              id: 1,\n              email: '',\n              is_active: true,\n              is_superuser: true,\n              created_at: new Date().toISOString()\n            } as AdminUser,\n            loading: false,\n          });\n\n          return true;\n        } catch (error) {\n          set({\n            error: apiUtils.handleApiError(error),\n            loading: false,\n          });\n          return false;\n        }\n      },\n\n      logout: () => {\n        localStorage.removeItem('admin_token');\n        set({\n          user: null,\n          token: null,\n          error: null,\n        });\n      },\n\n      checkAuth: async () => {\n        const token = localStorage.getItem('admin_token');\n        if (token) {\n          try {\n            // Validierung durch einen API-Call zum Backend\n            await adminApi.getReviews({ page: 1, per_page: 1 });\n            set({ \n              token,\n              user: {\n                id: 1,\n                username: 'admin',\n                email: 'admin@guestbook.local',\n                is_active: true,\n                is_superuser: true,\n                created_at: new Date().toISOString()\n              }\n            });\n          } catch (error: any) {\n            // Token ist ungültig oder Session abgelaufen\n            if (error.response?.status === 401 || error.response?.status === 403) {\n              localStorage.removeItem('admin_token');\n              set({ token: null, user: null });\n            }\n          }\n        }\n      },\n\n      // Neue Funktion für kontinuierliche Session-Überwachung\n      validateSession: async () => {\n        const token = get().token;\n        if (!token) return false;\n        \n        try {\n          await adminApi.getReviews({ page: 1, per_page: 1 });\n          return true;\n        } catch (error: any) {\n          if (error.response?.status === 401 || error.response?.status === 403) {\n            get().logout();\n            return false;\n          }\n          return true; // Anderer Fehler, Session könnte noch gültig sein\n        }\n      },\n\n      clearError: () => set({ error: null }),\n    }),\n    {\n      name: 'auth-storage',\n      partialize: (state) => ({ \n        token: state.token,\n        user: state.user \n      }),\n    }\n  )\n);\n"],"mappings":"AAAA,OAASA,MAAM,KAAQ,SAAS,CAChC,OAASC,OAAO,KAAQ,oBAAoB,CAE5C,OAASC,QAAQ,CAAEC,QAAQ,KAAQ,QAAQ,CAE3C,MAAO,MAAM,CAAAC,YAAY,CAAGJ,MAAM,CAAY,CAAC,CAC7CC,OAAO,CACL,CAACI,GAAG,CAAEC,GAAG,IAAM,CACbC,IAAI,CAAE,IAAI,CACVC,KAAK,CAAE,IAAI,CACXC,OAAO,CAAE,KAAK,CACdC,KAAK,CAAE,IAAI,CAEXC,KAAK,CAAE,KAAO,CAAAC,WAAsB,EAAK,CACvCP,GAAG,CAAC,CAAEI,OAAO,CAAE,IAAI,CAAEC,KAAK,CAAE,IAAK,CAAC,CAAC,CACnC,GAAI,CACF,KAAM,CAAAG,aAAa,CAAG,KAAM,CAAAX,QAAQ,CAACS,KAAK,CAACC,WAAW,CAAC,CAEvD;AACAE,YAAY,CAACC,OAAO,CAAC,aAAa,CAAEF,aAAa,CAACG,YAAY,CAAC,CAE/DX,GAAG,CAAC,CACFG,KAAK,CAAEK,aAAa,CAACG,YAAY,CACjCT,IAAI,CAAE,CACJU,QAAQ,CAAEL,WAAW,CAACK,QAAQ,CAC9B;AACAC,EAAE,CAAE,CAAC,CACLC,KAAK,CAAE,EAAE,CACTC,SAAS,CAAE,IAAI,CACfC,YAAY,CAAE,IAAI,CAClBC,UAAU,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CACrC,CAAc,CACdf,OAAO,CAAE,KACX,CAAC,CAAC,CAEF,MAAO,KAAI,CACb,CAAE,MAAOC,KAAK,CAAE,CACdL,GAAG,CAAC,CACFK,KAAK,CAAEP,QAAQ,CAACsB,cAAc,CAACf,KAAK,CAAC,CACrCD,OAAO,CAAE,KACX,CAAC,CAAC,CACF,MAAO,MAAK,CACd,CACF,CAAC,CAEDiB,MAAM,CAAEA,CAAA,GAAM,CACZZ,YAAY,CAACa,UAAU,CAAC,aAAa,CAAC,CACtCtB,GAAG,CAAC,CACFE,IAAI,CAAE,IAAI,CACVC,KAAK,CAAE,IAAI,CACXE,KAAK,CAAE,IACT,CAAC,CAAC,CACJ,CAAC,CAEDkB,SAAS,CAAE,KAAAA,CAAA,GAAY,CACrB,KAAM,CAAApB,KAAK,CAAGM,YAAY,CAACe,OAAO,CAAC,aAAa,CAAC,CACjD,GAAIrB,KAAK,CAAE,CACT,GAAI,CACF;AACA,KAAM,CAAAN,QAAQ,CAAC4B,UAAU,CAAC,CAAEC,IAAI,CAAE,CAAC,CAAEC,QAAQ,CAAE,CAAE,CAAC,CAAC,CACnD3B,GAAG,CAAC,CACFG,KAAK,CACLD,IAAI,CAAE,CACJW,EAAE,CAAE,CAAC,CACLD,QAAQ,CAAE,OAAO,CACjBE,KAAK,CAAE,uBAAuB,CAC9BC,SAAS,CAAE,IAAI,CACfC,YAAY,CAAE,IAAI,CAClBC,UAAU,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CACrC,CACF,CAAC,CAAC,CACJ,CAAE,MAAOd,KAAU,CAAE,KAAAuB,eAAA,CAAAC,gBAAA,CACnB;AACA,GAAI,EAAAD,eAAA,CAAAvB,KAAK,CAACyB,QAAQ,UAAAF,eAAA,iBAAdA,eAAA,CAAgBG,MAAM,IAAK,GAAG,EAAI,EAAAF,gBAAA,CAAAxB,KAAK,CAACyB,QAAQ,UAAAD,gBAAA,iBAAdA,gBAAA,CAAgBE,MAAM,IAAK,GAAG,CAAE,CACpEtB,YAAY,CAACa,UAAU,CAAC,aAAa,CAAC,CACtCtB,GAAG,CAAC,CAAEG,KAAK,CAAE,IAAI,CAAED,IAAI,CAAE,IAAK,CAAC,CAAC,CAClC,CACF,CACF,CACF,CAAC,CAED;AACA8B,eAAe,CAAE,KAAAA,CAAA,GAAY,CAC3B,KAAM,CAAA7B,KAAK,CAAGF,GAAG,CAAC,CAAC,CAACE,KAAK,CACzB,GAAI,CAACA,KAAK,CAAE,MAAO,MAAK,CAExB,GAAI,CACF,KAAM,CAAAN,QAAQ,CAAC4B,UAAU,CAAC,CAAEC,IAAI,CAAE,CAAC,CAAEC,QAAQ,CAAE,CAAE,CAAC,CAAC,CACnD,MAAO,KAAI,CACb,CAAE,MAAOtB,KAAU,CAAE,KAAA4B,gBAAA,CAAAC,gBAAA,CACnB,GAAI,EAAAD,gBAAA,CAAA5B,KAAK,CAACyB,QAAQ,UAAAG,gBAAA,iBAAdA,gBAAA,CAAgBF,MAAM,IAAK,GAAG,EAAI,EAAAG,gBAAA,CAAA7B,KAAK,CAACyB,QAAQ,UAAAI,gBAAA,iBAAdA,gBAAA,CAAgBH,MAAM,IAAK,GAAG,CAAE,CACpE9B,GAAG,CAAC,CAAC,CAACoB,MAAM,CAAC,CAAC,CACd,MAAO,MAAK,CACd,CACA,MAAO,KAAI,CAAE;AACf,CACF,CAAC,CAEDc,UAAU,CAAEA,CAAA,GAAMnC,GAAG,CAAC,CAAEK,KAAK,CAAE,IAAK,CAAC,CACvC,CAAC,CAAC,CACF,CACE+B,IAAI,CAAE,cAAc,CACpBC,UAAU,CAAGC,KAAK,GAAM,CACtBnC,KAAK,CAAEmC,KAAK,CAACnC,KAAK,CAClBD,IAAI,CAAEoC,KAAK,CAACpC,IACd,CAAC,CACH,CACF,CACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}